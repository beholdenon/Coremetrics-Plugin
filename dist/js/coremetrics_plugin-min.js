window.bl=window.bl||{},function(t){var e=!1,r=window.ENV_CONFIG||"dev",i=window.location.host,o=["fashion.bloomingdales.com","www.bloomingdales.com","m.bloomingdales.com"],n={category_id:"",page_paths:{},call_page_tags:!0,use_attribute_tags:!0,attribute_tag:"coremetricTag"};var c=function(t,e,r){for(var i=0;i<t.length;i++)e.call(r,i,t[i])};function a(){(e=function(){try{return!(!BLOOMIES||!BLOOMIES.coremetrics)}catch(t){return d("ERROR: Could not find coremetrics library (from checkForCoremetrics method): "+t),!1}}())?(d("Library Initiated"),function(){if(window.BLOOMIES.coremetrics.pageViewExploreAttributes=new window.BLOOMIES.coremetrics.exploreAttributes,"dev"===r)return cmSetTest();if("production"===r)return o.indexOf(l)>=0?cmSetProduction():cmSetTest();throw"ERROR: Unidentified env variable (from initEnvironment method)"}(),function(){if(n.use_attribute_tags){var t=document.querySelectorAll("["+n.attribute_tag+"]");c(t,function(t,e){e.onclick=function(){u({type:"element",id:e.getAttribute(n.attribute_tag),cat:n.category_id})}})}}(),function(){if(n.page_paths!={}&&n.call_page_tags){var t=n.page_paths[l()];void 0!==t&&u({type:"page",id:t,cat:n.category_id})}}()):d("ERROR: Could not find coremetrics library (from init method)")}function d(t){window.console&&-1===o.indexOf(i)&&console.log(t)}function u(t){if(function(t){return e?void 0===t?(d("ERROR: Params not set"),!1):void 0!==t.id||(d("ERROR: ID not set"),!1):(d("ERROR: Coremetrics library not found"),!1)}(t)){var r=t.cat||n.category_id,i=t.id,o=t.type;if(i)switch(o){case"element":!function(t,e){try{BLOOMIES.coremetrics.cmCreatePageElementTag(t,e),d("Coremetrics Element: Category: "+e+" ID: "+t)}catch(t){d("cmCreatePageElementTag Error: "+t)}}(i,r);break;default:!function(t,e){try{BLOOMIES.coremetrics.cmCreatePageviewTag(t,e,"",""),d("Coremetrics Page: Category: "+e+" ID: "+t)}catch(t){d("cmCreatePageviewTag Error: "+t)}}(i,r)}else d("ERROR: No id specified (from fireTag Method)")}}function l(){var t=window.location.pathname.split("/");return""===t[t.length-1]?t[t.length-2]:t[t.length-1]}t.init=function(t){n=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(n,t),a()},t.fireTag=function(t){u(t)},t.path=function(){return l()},t.category_id=function(t){if(!t)return n.category_id;n.category_id=t},t.libraryFound=function(){return e}}(window.bl.coremetrics=window.bl.coremetrics||{});