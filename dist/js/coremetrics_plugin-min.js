window.bl=window.bl||{},function(t,e){var i=!1,o=window.ENV_CONFIG||"dev",r=(window.location.host,["fashion.bloomingdales.com","www.bloomingdales.com","m.bloomingdales.com"]),n={category_id:"",page_paths:{},call_page_tags:!0,use_attribute_tags:!0,attribute_tag:"coremetricTag"};function c(){(i=function(){try{return!(!window.BLOOMIES||!window.BLOOMIES.coremetrics)}catch(t){return e.utils.log("ERROR: Could not find coremetrics library (from checkForCoremetrics method): "+t),!1}}())?(e.utils.log("Library Initiated"),function(){if(window.BLOOMIES.coremetrics.pageViewExploreAttributes=new window.BLOOMIES.coremetrics.exploreAttributes,"dev"===o)return cmSetTest();if("production"===o)return r.indexOf(l)>=0?cmSetProduction():cmSetTest();throw"ERROR: Unidentified env variable (from initEnvironment method)"}(),function(){if(n.use_attribute_tags){var t=document.querySelectorAll("["+n.attribute_tag+"]");window.bl.utils.forEach(t,function(t,e){e.onclick=function(){a({type:"element",id:e.getAttribute(n.attribute_tag),cat:n.category_id})}})}}(),function(){if(n.page_paths!={}&&n.call_page_tags){var t=n.page_paths[l()];void 0!==t&&a({type:"page",id:t,cat:n.category_id})}}()):e.utils.log("ERROR: Could not find coremetrics library (from init method)")}function a(t){if(function(t){return i?void 0===t?(e.utils.log("ERROR: Params not set"),!1):void 0!==t.id||(e.utils.log("ERROR: ID not set"),!1):(e.utils.log("ERROR: Coremetrics library not found"),!1)}(t)){var o=t.cat||n.category_id,r=t.id,c=t.type;if(r)switch(c){case"element":!function(t,i){try{window.BLOOMIES.coremetrics.cmCreatePageElementTag(t,i),e.utils.log("Coremetrics Element: Category: "+i+" ID: "+t)}catch(t){e.utils.log("cmCreatePageElementTag Error: "+t)}}(r,o);break;default:!function(t,i){try{window.BLOOMIES.coremetrics.cmCreatePageviewTag(t,i,"",""),e.utils.log("Coremetrics Page: Category: "+i+" ID: "+t)}catch(t){e.utils.log("cmCreatePageviewTag Error: "+t)}}(r,o)}else e.utils.log("ERROR: No id specified (from fireTag Method)")}}function l(){var t=window.location.pathname.split("/");return""===t[t.length-1]?t[t.length-2]:t[t.length-1]}t.init=function(t){n=window.bl.utils.extend(n,t),c()},t.fireTag=function(t){a(t)},t.path=function(){return l()},t.category_id=function(t){if(!t)return n.category_id;n.category_id=t},t.libraryFound=function(){return i}}(window.bl.coremetrics=window.bl.coremetrics||{},window.bl);